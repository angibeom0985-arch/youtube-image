<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>콘텐츠 안전성 테스트</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        margin-bottom: 20px;
      }
      textarea {
        width: 100%;
        height: 150px;
        padding: 10px;
        border: 2px solid #ddd;
        border-radius: 5px;
        font-size: 14px;
        margin-bottom: 10px;
        resize: vertical;
      }
      button {
        background: #4caf50;
        color: white;
        padding: 12px 30px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-right: 10px;
      }
      button:hover {
        background: #45a049;
      }
      .clear-btn {
        background: #f44336;
      }
      .clear-btn:hover {
        background: #da190b;
      }
      .result {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
      }
      .safe {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        color: #155724;
      }
      .unsafe {
        background: #f8d7da;
        border: 1px solid #f5c6cb;
        color: #721c24;
      }
      .replacement {
        background: #fff3cd;
        border: 1px solid #ffeeba;
        color: #856404;
        margin-top: 10px;
      }
      .word-list {
        margin-top: 10px;
        font-family: monospace;
      }
      .test-cases {
        margin-top: 30px;
        padding: 20px;
        background: #e3f2fd;
        border-radius: 5px;
      }
      .test-case {
        margin: 10px 0;
        padding: 10px;
        background: white;
        border-left: 4px solid #2196f3;
        cursor: pointer;
      }
      .test-case:hover {
        background: #f5f5f5;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>🛡️ 콘텐츠 안전성 테스트</h1>
      <p>
        아래 텍스트 입력란에 테스트할 문장을 입력하고 "검사하기" 버튼을
        클릭하세요.
      </p>

      <textarea
        id="inputText"
        placeholder="예: 살인 사건을 조사하는 형사"
      ></textarea>

      <button onclick="checkSafety()">🔍 검사하기</button>
      <button class="clear-btn" onclick="clearInput()">🗑️ 지우기</button>

      <div id="result"></div>

      <div class="test-cases">
        <h3>📋 테스트 케이스 (클릭하여 자동 입력)</h3>
        <div class="test-case" onclick="setTestCase(this)">
          살인 사건을 조사하는 형사
        </div>
        <div class="test-case" onclick="setTestCase(this)">
          공포 영화에 나오는 무서운 괴물
        </div>
        <div class="test-case" onclick="setTestCase(this)">
          위험한 범죄자와 대결하는 경찰
        </div>
        <div class="test-case" onclick="setTestCase(this)">
          어두운 밤, 저주받은 마을
        </div>
        <div class="test-case" onclick="setTestCase(this)">
          폭력적인 싸움 장면
        </div>
        <div class="test-case" onclick="setTestCase(this)">
          죽음의 그림자가 드리운 도시
        </div>
        <div class="test-case" onclick="setTestCase(this)">
          악역이 칼을 들고 위협하는 장면
        </div>
        <div class="test-case" onclick="setTestCase(this)">
          평화로운 일상을 보내는 가족
        </div>
      </div>
    </div>

    <script>
      // 콘텐츠 안전성 맵 (contentSafety.ts에서 복사)
      const UNSAFE_WORDS_MAP = {
        // 범죄 관련
        공범: "협력자",
        범죄자: "인물",
        악역: "상대역",
        악당: "상대역",
        악인: "인물",
        범인: "인물",
        살인자: "인물",
        살인범: "인물",
        살인: "사건",
        살해: "사건",
        도둑: "인물",
        강도: "인물",
        강도질: "사건",
        범죄: "사건",
        납치: "사건",
        유괴: "사건",
        테러: "사건",
        테러범: "인물",
        암살: "사건",
        암살자: "인물",

        // 폭력 관련
        위험한: "신중한",
        위험: "조심스러운",
        무서운: "진지한",
        위협적인: "당당한",
        위협: "도전",
        잔인한: "엄격한",
        잔인: "강한",
        포악한: "강인한",
        포악: "강인함",
        폭력: "힘",
        폭력적: "강한",
        공격: "행동",
        공격적: "적극적",
        싸움: "경쟁",
        전쟁: "경쟁",
        전투: "경쟁",
        무기: "도구",
        칼: "도구",
        검: "도구",
        총: "도구",
        권총: "도구",
        폭탄: "물건",
        폭발: "사건",
        피: "붉은색",
        피가: "붉은색이",
        피를: "붉은색을",
        피범벅: "붉은색",
        피투성이: "붉은색",
        죽음: "종말",
        죽은: "고요한",
        죽이: "멈추",
        사망: "종말",
        사체: "인물",
        시체: "인물",
        고문: "심문",
        구타: "충돌",
        폭행: "충돌",
        학대: "어려움",

        // 외모/분위기 관련
        어둠: "진한 색",
        어두운: "진한 색의",
        어둡: "진한 색",
        검은: "어두운 색의",
        검정: "어두운 색",
        암흑: "진한 색",
        미스터리한: "신비로운",
        미스터리: "신비",
        수상한: "독특한",
        수상: "독특함",
        의심스러운: "신중한",
        의심: "주의",
        괴물: "독특한 존재",
        괴수: "큰 존재",
        귀신: "신비로운 존재",
        유령: "신비로운 존재",
        악마: "강한 존재",
        마귀: "강한 존재",
        악귀: "신비로운 존재",
        저주: "운명",
        저주받은: "운명적인",
        지옥: "어려운 곳",
        악몽: "꿈",

        // 부정적 감정/표현
        사악한: "카리스마 있는",
        사악: "강한 카리스마",
        음험한: "신중한",
        음험: "신중함",
        교활한: "영리한",
        교활: "영리함",
        간교한: "영리한",
        불길한: "신비로운",
        불길: "신비로움",
        흉악한: "강렬한",
        흉악: "강렬함",
        증오: "강한 감정",
        증오하: "싫어하",
        혐오: "거부감",
        혐오스: "불쾌한",
        공포: "긴장감",
        공포스: "긴장되는",
        끔찍: "강렬한",
        끔찍한: "강렬한",
        무시무시: "강렬한",
        소름: "놀라운",
        소름끼: "놀라운",
        섬뜩: "인상적",
        섬뜩한: "인상적인",
        잔혹: "강한",
        잔혹한: "강한",

        // 나이/신체 민감 표현
        늙은: "나이 든",
        노인: "어르신",
        할머니: "연세 드신 여성",
        할아버지: "연세 드신 남성",
        병든: "아픈",
        병자: "환자",
        장애: "특별한",
        장애인: "특별한 사람",
        불구: "특별한",
        추한: "독특한",
        못생긴: "독특한",

        // 기타 민감 표현
        음란: "매력적",
        음란한: "매력적인",
        선정적: "매력적",
        섹시: "매력적",
        야한: "매력적",
        나체: "인물",
        벗은: "단순한",
        벗긴: "단순한",
        술: "음료",
        술에: "음료에",
        담배: "물건",
        흡연: "휴식",
        마약: "물질",
        약물: "물질",
        자살: "종말",
        자해: "상처",
      };

      function detectUnsafeWords(text) {
        const foundWords = [];
        const sortedWords = Object.keys(UNSAFE_WORDS_MAP).sort(
          (a, b) => b.length - a.length
        );

        sortedWords.forEach((unsafeWord) => {
          const regex = new RegExp(unsafeWord, "g");
          if (regex.test(text)) {
            foundWords.push(unsafeWord);
          }
        });

        return [...new Set(foundWords)];
      }

      function replaceUnsafeWords(text) {
        let replacedText = text;
        const replacements = [];
        const sortedEntries = Object.entries(UNSAFE_WORDS_MAP).sort(
          ([a], [b]) => b.length - a.length
        );

        sortedEntries.forEach(([unsafeWord, safeWord]) => {
          const regex = new RegExp(unsafeWord, "g");
          if (regex.test(replacedText)) {
            replacedText = replacedText.replace(regex, safeWord);
            if (!replacements.find((r) => r.original === unsafeWord)) {
              replacements.push({
                original: unsafeWord,
                replacement: safeWord,
              });
            }
          }
        });

        return { replacedText, replacements };
      }

      function checkSafety() {
        const input = document.getElementById("inputText").value;
        const resultDiv = document.getElementById("result");

        if (!input.trim()) {
          resultDiv.innerHTML =
            '<div class="unsafe">❌ 텍스트를 입력해주세요.</div>';
          return;
        }

        const unsafeWords = detectUnsafeWords(input);

        if (unsafeWords.length === 0) {
          resultDiv.innerHTML = `
                    <div class="safe">
                        <strong>✅ 안전한 텍스트입니다!</strong><br>
                        감지된 위험 단어가 없습니다.
                    </div>
                `;
        } else {
          const { replacedText, replacements } = replaceUnsafeWords(input);
          const replacementList = replacements
            .map((r) => `<li>"${r.original}" → "${r.replacement}"</li>`)
            .join("");

          resultDiv.innerHTML = `
                    <div class="unsafe">
                        <strong>⚠️ 위험 단어 감지!</strong><br>
                        <div class="word-list">
                            감지된 단어: ${unsafeWords.join(", ")}
                        </div>
                    </div>
                    <div class="replacement">
                        <strong>🔄 자동 교체 결과:</strong><br>
                        <ul>${replacementList}</ul>
                        <strong>교체 후 텍스트:</strong><br>
                        <div class="word-list">${replacedText}</div>
                    </div>
                `;
        }
      }

      function clearInput() {
        document.getElementById("inputText").value = "";
        document.getElementById("result").innerHTML = "";
      }

      function setTestCase(element) {
        document.getElementById("inputText").value = element.textContent;
        checkSafety();
      }

      // Enter 키로 검사
      document
        .getElementById("inputText")
        .addEventListener("keypress", function (e) {
          if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            checkSafety();
          }
        });
    </script>
  </body>
</html>
