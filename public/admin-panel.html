<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì íŒ¨ë„ - ìœ íŠœë¸Œ ì´ë¯¸ì§€ ìƒì„±ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        .editor-container {
            height: 400px;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
        }
        .preview-container {
            height: 400px;
            overflow-y: auto;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            background: white;
            padding: 1rem;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- ì¸ì¦ í™•ì¸ -->
    <script>
        if (!sessionStorage.getItem('adminAuth')) {
            window.location.href = '/admin.html';
        }
    </script>

    <div class="container mx-auto px-4 py-8">
        <!-- í—¤ë” -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800">ğŸ› ï¸ ê´€ë¦¬ì íŒ¨ë„</h1>
                    <p class="text-gray-600 mt-1">ìœ íŠœë¸Œ ì´ë¯¸ì§€ ìƒì„±ê¸° ì½˜í…ì¸  ê´€ë¦¬</p>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-gray-600">
                        ğŸ‘‹ <span id="adminUser"></span>ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤
                    </span>
                    <button onclick="logout()" class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition-colors">
                        ğŸšª ë¡œê·¸ì•„ì›ƒ
                    </button>
                </div>
            </div>
        </div>

        <!-- ëŒ€ì‹œë³´ë“œ -->
        <div class="grid md:grid-cols-3 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center">
                    <div class="p-3 bg-blue-100 rounded-full">
                        <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                    </div>
                    <div class="ml-4">
                        <h3 class="text-lg font-semibold text-gray-800">ê°€ì´ë“œ ë¬¸ì„œ</h3>
                        <p class="text-gray-600">API í‚¤ ë° ì‚¬ìš©ë²• ê°€ì´ë“œ</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center">
                    <div class="p-3 bg-green-100 rounded-full">
                        <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                    </div>
                    <div class="ml-4">
                        <h3 class="text-lg font-semibold text-gray-800">ì´ë¯¸ì§€ ê´€ë¦¬</h3>
                        <p class="text-gray-600">ìŠ¤í¬ë¦°ìƒ· ë° ê°€ì´ë“œ ì´ë¯¸ì§€</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center">
                    <div class="p-3 bg-purple-100 rounded-full">
                        <svg class="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                    </div>
                    <div class="ml-4">
                        <h3 class="text-lg font-semibold text-gray-800">ì„¤ì • ê´€ë¦¬</h3>
                        <p class="text-gray-600">ì‚¬ì´íŠ¸ ì„¤ì • ë° ë°°í¬</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- íŒŒì¼ í¸ì§‘ ì„¹ì…˜ -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-2xl font-semibold mb-6">ğŸ“ ë¬¸ì„œ í¸ì§‘</h2>
            
            <!-- íŒŒì¼ ì„ íƒ -->
            <div class="grid md:grid-cols-2 gap-4 mb-6">
                <div>
                    <h3 class="font-medium mb-3">í¸ì§‘í•  ë¬¸ì„œ ì„ íƒ</h3>
                    <div class="space-y-2">
                        <button onclick="loadFile('api-key-guide.html')" 
                                class="w-full text-left p-3 border rounded hover:bg-blue-50 transition-colors">
                            ğŸ“‹ API í‚¤ ë°œê¸‰ ê°€ì´ë“œ
                        </button>
                        <button onclick="loadFile('user-guide.html')" 
                                class="w-full text-left p-3 border rounded hover:bg-blue-50 transition-colors">
                            ğŸ“– ì‚¬ìš©ë²• ê°€ì´ë“œ
                        </button>
                        <button onclick="loadFile('index.html')" 
                                class="w-full text-left p-3 border rounded hover:bg-blue-50 transition-colors">
                            ğŸ  ë©”ì¸ í˜ì´ì§€
                        </button>
                    </div>
                </div>
                
                <div>
                    <h3 class="font-medium mb-3">í˜„ì¬ í¸ì§‘ ì¤‘ì¸ íŒŒì¼</h3>
                    <div id="current-file" class="p-4 bg-gray-50 rounded border">
                        íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”
                    </div>
                    
                    <!-- ë¹ ë¥¸ ì•¡ì…˜ -->
                    <div class="mt-4 space-y-2">
                        <button onclick="addImage()" class="w-full px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors">
                            ğŸ–¼ï¸ ì´ë¯¸ì§€ ì¶”ê°€
                        </button>
                        <button onclick="addStep()" class="w-full px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors">
                            ğŸ“‹ ë‹¨ê³„ ì¶”ê°€
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- í¸ì§‘ê¸° -->
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <h3 class="text-lg font-semibold mb-3">ğŸ“ í¸ì§‘ê¸°</h3>
                    <textarea id="editor" 
                              class="w-full editor-container p-4 font-mono text-sm border rounded resize-none"
                              placeholder="HTML ë˜ëŠ” ë§ˆí¬ë‹¤ìš´ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                    
                    <!-- ì´ë¯¸ì§€ ì—…ë¡œë“œ -->
                    <div class="mt-4">
                        <label class="block font-medium mb-2">ğŸ–¼ï¸ ì´ë¯¸ì§€ ì—…ë¡œë“œ</label>
                        <input type="file" id="image-upload" accept="image/*" 
                               class="w-full p-2 border rounded" onchange="handleImageUpload(event)">
                        <div id="image-preview" class="mt-2"></div>
                    </div>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold mb-3">ğŸ‘ï¸ ë¯¸ë¦¬ë³´ê¸°</h3>
                    <div id="preview" class="preview-container"></div>
                </div>
            </div>
            
            <!-- ì €ì¥ ë° ë°°í¬ ë²„íŠ¼ -->
            <div class="flex gap-4 mt-6">
                <button onclick="updatePreview()" 
                        class="px-6 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors">
                    ğŸ”„ ë¯¸ë¦¬ë³´ê¸° ìƒˆë¡œê³ ì¹¨
                </button>
                <button onclick="saveFile()" 
                        class="px-6 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors">
                    ğŸ’¾ íŒŒì¼ ì €ì¥
                </button>
                <button onclick="deployChanges()" 
                        class="px-6 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 transition-colors">
                    ğŸš€ Gitì— ì»¤ë°‹ & ë°°í¬
                </button>
                <button onclick="viewSite()" 
                        class="px-6 py-2 bg-indigo-500 text-white rounded hover:bg-indigo-600 transition-colors">
                    ğŸŒ ì‚¬ì´íŠ¸ ë³´ê¸°
                </button>
            </div>
        </div>

        <!-- ë¡œê·¸ ì„¹ì…˜ -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-2xl font-semibold mb-4">ğŸ“œ ì‘ì—… ë¡œê·¸</h2>
            <div id="activity-log" class="bg-gray-50 p-4 rounded border max-h-60 overflow-y-auto">
                <p class="text-gray-600 text-sm">ê´€ë¦¬ì íŒ¨ë„ ë¡œë“œ ì™„ë£Œ - <span class="timestamp"></span></p>
            </div>
        </div>
    </div>

    <script>
        let currentFile = '';
        let fileContent = '';
        
        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('adminUser').textContent = sessionStorage.getItem('adminUser') || 'Admin';
            document.querySelector('.timestamp').textContent = new Date().toLocaleString('ko-KR');
        });

        // ë¡œê·¸ì•„ì›ƒ
        function logout() {
            sessionStorage.removeItem('adminAuth');
            sessionStorage.removeItem('adminUser');
            window.location.href = '/admin.html';
        }

        // íŒŒì¼ ë¡œë“œ
        async function loadFile(filename) {
            try {
                let filePath = filename;
                if (filename !== 'index.html') {
                    filePath = `/guides/${filename}`;
                }
                
                const response = await fetch(filePath);
                if (response.ok) {
                    fileContent = await response.text();
                    document.getElementById('editor').value = fileContent;
                    document.getElementById('current-file').innerHTML = `
                        <div class="flex items-center">
                            <span class="text-green-600 mr-2">ğŸ“„</span>
                            <span class="font-medium">${filename}</span>
                            <span class="ml-2 px-2 py-1 bg-green-100 text-green-800 text-xs rounded">ë¡œë“œë¨</span>
                        </div>
                    `;
                    currentFile = filename;
                    updatePreview();
                    addLog(`íŒŒì¼ ë¡œë“œ: ${filename}`);
                } else {
                    alert('íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    addLog(`íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨: ${filename}`, 'error');
                }
            } catch (error) {
                console.error('íŒŒì¼ ë¡œë“œ ì˜¤ë¥˜:', error);
                alert('íŒŒì¼ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                addLog(`íŒŒì¼ ë¡œë“œ ì˜¤ë¥˜: ${filename}`, 'error');
            }
        }

        // ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
        function updatePreview() {
            const content = document.getElementById('editor').value;
            const preview = document.getElementById('preview');
            
            if (content.includes('<!DOCTYPE') || content.includes('<html')) {
                const iframe = document.createElement('iframe');
                iframe.style.width = '100%';
                iframe.style.height = '100%';
                iframe.style.border = 'none';
                preview.innerHTML = '';
                preview.appendChild(iframe);
                iframe.contentDocument.write(content);
                iframe.contentDocument.close();
            } else {
                preview.innerHTML = marked.parse(content);
            }
            addLog('ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸');
        }

        // ì´ë¯¸ì§€ ì—…ë¡œë“œ
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imagePreview = document.getElementById('image-preview');
                    imagePreview.innerHTML = `
                        <div class="mt-2 p-3 border rounded bg-gray-50">
                            <img src="${e.target.result}" class="max-w-full h-24 object-contain mx-auto mb-2">
                            <p class="text-sm text-gray-600 text-center">
                                ê²½ë¡œ: /images/${file.name}
                            </p>
                            <button onclick="insertImageTag('${file.name}')" 
                                    class="mt-2 w-full px-3 py-1 bg-blue-500 text-white text-sm rounded hover:bg-blue-600">
                                í¸ì§‘ê¸°ì— ì‚½ì…
                            </button>
                        </div>
                    `;
                    addLog(`ì´ë¯¸ì§€ ì—…ë¡œë“œ: ${file.name}`);
                };
                reader.readAsDataURL(file);
            }
        }

        // ì´ë¯¸ì§€ íƒœê·¸ ì‚½ì…
        function insertImageTag(filename) {
            const editor = document.getElementById('editor');
            const imageTag = `\n<img src="/images/${filename}" alt="${filename}" class="max-w-full h-auto rounded shadow-md my-4">\n`;
            editor.value += imageTag;
            updatePreview();
            addLog(`ì´ë¯¸ì§€ íƒœê·¸ ì‚½ì…: ${filename}`);
        }

        // ë‹¨ê³„ ì¶”ê°€
        function addStep() {
            const stepNumber = prompt('ë‹¨ê³„ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
            const stepTitle = prompt('ë‹¨ê³„ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”:');
            if (stepNumber && stepTitle) {
                const editor = document.getElementById('editor');
                const stepTemplate = `
<div class="step-card bg-white p-6 rounded-lg shadow-md mb-6">
    <div class="flex items-center mb-4">
        <span class="bg-blue-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold mr-3">${stepNumber}</span>
        <h3 class="text-xl font-semibold">${stepTitle}</h3>
    </div>
    <p class="text-gray-700 mb-4">ë‹¨ê³„ ì„¤ëª…ì„ ì—¬ê¸°ì— ì…ë ¥í•˜ì„¸ìš”.</p>
</div>`;
                editor.value += stepTemplate;
                updatePreview();
                addLog(`ë‹¨ê³„ ì¶”ê°€: ${stepNumber}. ${stepTitle}`);
            }
        }

        // ì´ë¯¸ì§€ ì¶”ê°€ ë²„íŠ¼
        function addImage() {
            document.getElementById('image-upload').click();
        }

        // íŒŒì¼ ì €ì¥
        function saveFile() {
            if (!currentFile) {
                alert('ë¨¼ì € íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const content = document.getElementById('editor').value;
            
            // ì‹¤ì œë¡œëŠ” ì„œë²„ API í˜¸ì¶œì´ í•„ìš”í•˜ì§€ë§Œ, ì—¬ê¸°ì„œëŠ” ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì‚¬ìš©
            localStorage.setItem(`edited_${currentFile}`, content);
            
            addLog(`íŒŒì¼ ì €ì¥: ${currentFile}`, 'success');
            alert('íŒŒì¼ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! (ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì„ì‹œ ì €ì¥ë¨)');
        }

        // ë°°í¬
        function deployChanges() {
            if (!currentFile) {
                alert('ë¨¼ì € íŒŒì¼ì„ í¸ì§‘í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (confirm('ë³€ê²½ì‚¬í•­ì„ Gitì— ì»¤ë°‹í•˜ê³  ë°°í¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                addLog('ë°°í¬ ì‹œì‘...', 'info');
                // ì‹¤ì œë¡œëŠ” ì„œë²„ API í˜¸ì¶œ
                setTimeout(() => {
                    addLog('ë°°í¬ ì™„ë£Œ!', 'success');
                    alert('ë°°í¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! (ì‹¤ì œë¡œëŠ” Git API êµ¬í˜„ í•„ìš”)');
                }, 2000);
            }
        }

        // ì‚¬ì´íŠ¸ ë³´ê¸°
        function viewSite() {
            window.open('/', '_blank');
        }

        // ë¡œê·¸ ì¶”ê°€
        function addLog(message, type = 'info') {
            const logContainer = document.getElementById('activity-log');
            const timestamp = new Date().toLocaleString('ko-KR');
            const colors = {
                'info': 'text-blue-600',
                'success': 'text-green-600',
                'error': 'text-red-600'
            };
            
            const logEntry = document.createElement('p');
            logEntry.className = `text-sm ${colors[type] || 'text-gray-600'} mb-1`;
            logEntry.innerHTML = `${message} - <span class="text-gray-500">${timestamp}</span>`;
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // ìë™ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
        document.addEventListener('DOMContentLoaded', function() {
            const editor = document.getElementById('editor');
            if (editor) {
                editor.addEventListener('input', function() {
                    clearTimeout(this.updateTimeout);
                    this.updateTimeout = setTimeout(updatePreview, 1000);
                });
            }
        });
    </script>
</body>
</html>